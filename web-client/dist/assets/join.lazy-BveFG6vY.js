import{r as i,j as e,P as x,y as p,c as j}from"./index-D2oB8Xyz.js";import{b as y,o as b,A as g,I as u,s as m,P as v,c as w,d as h,a as S,g as N,e as k}from"./index.esm-Dd6_XDeN.js";import{L as f}from"./link-B-D0Gj-y.js";import{c as R}from"./createReactComponent-Dt5rK_xB.js";function C(s){const o=i.useRef(s);return i.useEffect(()=>{o.current=s}),i.useMemo(()=>(...a)=>{var t;return(t=o.current)==null?void 0:t.call(o,...a)},[])}const T=()=>{};function I(s,o){const a=o,t=!1,c=C(s),l=i.useRef(0),n=Object.assign(i.useCallback((...r)=>{window.clearTimeout(l.current);const d=()=>{l.current!==0&&(l.current=0,c(...r))};n.flush=d,l.current=window.setTimeout(d,a)},[c,a]),{flush:T});return i.useEffect(()=>()=>{window.clearTimeout(l.current)},[n,t]),n}/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var P=R("outline","download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);const _=({onSubmit:s,loading:o,apiError:a})=>{const t=y({defaultValues:{},resolver:b(q)}),c=n=>{s(n)},l=I(async n=>{console.log(n)},1e3);return e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(x,{withBorder:!0,p:"lg",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"mt-1 text-2xl",children:"Blackout Chat"}),e.jsx("p",{className:"text-sm text-[#667781] my-3",children:"Blackout chat is an invitation only platform. You must be invited by a reference handle to join."})]}),a&&e.jsx(g,{color:"red",title:"Hands up",radius:"md",children:a}),e.jsxs("form",{method:"POST",onSubmit:t.handleSubmit(c),className:"flex flex-col gap-4",children:[e.jsx(u.Wrapper,{label:"Your handle",error:e.jsx(m,{errors:t.formState.errors,name:"handle"}),children:e.jsx(u,{leftSection:e.jsx("span",{className:"text-gray-400",children:"@"}),placeholder:"Type your handle",size:"md",onChange:n=>{t.setValue("handle",n.target.value),l(n.target.value)},value:t.watch("handle")})}),e.jsx(u.Wrapper,{label:"Referer handle",error:e.jsx(m,{errors:t.formState.errors,name:"referenceHandle"}),description:"This is an invitation only platform. You must be invited by a reference handle to join.",children:e.jsx(u,{leftSection:e.jsx("span",{className:"text-gray-400",children:"@"}),placeholder:"Your referer handle",size:"md",...t.register("referenceHandle")})}),e.jsx(u.Wrapper,{label:"Pin",error:e.jsx(m,{errors:t.formState.errors,name:"pin"}),description:"The 6 digit pin code for your account login",children:e.jsx(v,{length:6,size:"md",type:"number",onChange:n=>t.setValue("pin",n)})}),e.jsx(p,{type:"submit",loading:o,children:"Join"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("p",{children:["Already have an account?"," ",e.jsx(f,{to:"/auth/login",className:"link",children:"Login now"})]})})]})})},q=w({handle:h().required().label("Handle"),referenceHandle:h().required().label("Reference Handle"),pin:h().required("Your pin is required").min(6).max(6).label("Pin")}),E=j("/auth/join")({component:A});function A(){var n;const[s,o]=i.useState(!1),[a,t]=i.useState(""),c=S({mutationFn:r=>N({variables:r,query:O,options:{passAccessToken:!0}}),onSuccess:r=>{console.log(r),o(!0),t(r.identity__join.secret)}}),l=()=>{const r=document.createElement("a"),d=new Blob([a],{type:"text/plain"});r.href=URL.createObjectURL(d),r.download="account-secret.txt",document.body.appendChild(r),r.click()};return i.useEffect(()=>{s&&l()},[s]),e.jsx("div",{className:"max-w-md mx-auto",children:s?e.jsxs(x,{withBorder:!0,p:"lg",children:[e.jsx("h2",{className:"text-2xl",children:"Success"}),e.jsx("p",{className:"my-3 text-md",children:"Your account has been created. Please save your account secret below."}),e.jsxs("div",{className:"p-3 border-2 border-red-500 border-dashed",children:[e.jsx("p",{className:"my-3 font-semibold text-red-500 text-md",children:"Keep this account secret safe. You will need it to reset your pin or recover your account. This is the only way to recover your account. Without this secret, you will not be able to recover your account."}),e.jsx("p",{className:"my-3 text-md",children:"Your account secret is"}),e.jsx(u,{value:a,size:"md",readOnly:!0}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{rightSection:e.jsx(P,{size:16}),mt:"md",onClick:l,children:"Download Account Secret"}),e.jsx(f,{to:"/auth/login",className:"link",children:"Login now"})]})]})]}):e.jsx(e.Fragment,{children:e.jsx(_,{onSubmit:r=>c.mutate({input:r}),loading:c.isPending,apiError:(n=c==null?void 0:c.error)==null?void 0:n.message})})})}const O=k`
  mutation Identity__join($input: JoinUserInput!) {
    identity__join(input: $input) {
      secret
      handle
    }
  }
`;export{E as Route};
